"use strict";

var gulp    = require('gulp');
var plugins = require('gulp-load-plugins')();



gulp.task('build', function () {
    return gulp.src('source/app.js')
        .pipe(plugins.babel())
        .pipe(plugins.uglify())
        .pipe(gulp.dest('dist'));
});

gulp.task('reactify', function() {
    return gulp.src('source/**/*.jsx')
        .pipe(plugins.react())
        .pipe(plugins.livereload())
});


gulp.task('transpile', watchify(function(watchify) {
    return gulp.src('source/js/app.js')
        .pipe(watchify({
            watch: true
        }))
        .pipe(babel())
        .pipe(gulp.dest('tmp'))
        .pipe(plugins.livereload());
}))

gulp.task('reloadHTML', function() {
    return gulp.src('source/**/*.html')
        .pipe(plugins.livereload())
});

gulp.task('watch', function () {
    plugins.livereload.listen();
    plugins.connect.server({
        root: ['tmp', 'source'],
        port: 8080,
        livereload: true
    });

    gulp.src('source/index.html')
        .pipe(plugins.open('', { url: 'http://localhost:8080' }));

    gulp.watch('source/**/*.js',  ['transpile']);
    gulp.watch('source/**/*.jsx', ['reactify']);
    gulp.watch('source/**/*.html', ['reloadHTML']);
});

//-----------------------------
{
  "name": "es6_chat",
  "version": "0.0.1",
  "description": "This is a javascript implementation of an chat using react, flux and es6",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/webPapaya/es6_chat.git"
  },
  "keywords": [
    "ES6",
    "Chat",
    "NodeJS",
    "React",
    "Flux"
  ],
  "author": "Thomas Mayrhofer",
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/webPapaya/es6_chat/issues"
  },
  "devDependencies": {
    "babelify": "^6.1.2",
    "gulp": "^3.8.11",
    "gulp-babel": "^5.1.0",
    "gulp-browserify": "^0.5.1",
    "gulp-connect": "^2.2.0",
    "gulp-embedlr": "^0.5.2",
    "gulp-livereload": "^3.8.0",
    "gulp-load-plugins": "^0.10.0",
    "gulp-open": "^0.3.2",
    "gulp-react": "^3.0.1",
    "gulp-sourcemaps": "^1.5.2",
    "gulp-uglify": "^1.2.0",
    "gulp-watch": "^4.2.4",
    "gulp-watchify": "^0.5.0",
    "watchify": "^3.2.1"
  }
}
